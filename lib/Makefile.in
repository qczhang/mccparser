#                            -*- Mode: Makefile -*-
# Makefile.in
# Copyright © 2000-03 Laboratoire de Biologie Informatique et Théorique.
# Author           : Martin Larose
# Created On       : Mon Aug 21 16:06:06 2000
# $Revision$$
# $Id$


PACKAGE = @PACKAGE@
VERSION = @VERSION@

srcdir = @srcdir@
VPATH = @srcdir@

prefix = @prefix@
exec_prefix = @exec_prefix@
datadir = @datadir@
includedir = @includedir@
libdir = @libdir@

CXX = @CXX@
CXXFLAGS = @CXXFLAGS@
DEPFLAGS = @DEPFLAGS@
DEFS = @DEFS@
LD = @CXX@
LINKOPTIONS = @LINKOPTIONS@
LDFLAGS = @LDFLAGS@
LDNAMEPARAM = @LDNAMEPARAM@
LIBS = @LIBS@

ARXX = @ARXX@
AROPTIONS = @AROPTIONS@
LEX = @LEX@
YACC = @YACC@

INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@
INSTALL_PROGRAM = @INSTALL_PROGRAM@


.SUFFIXES:

%.d: %.cc
	@ $(SHELL) -ec '$(CXX) $(DEPFLAGS) $(CXXFLAGS) $(DEFS) \
              -I$(srcdir) $< \
	    | sed '\''s/\($*\)\.o[ :]*/\1.o \1.lo $@ : /g'\'' > $@; \
	      [ -s $@ ] || rm -f $@'

%.o: %.cc
	$(CXX) $(CXXFLAGS) -I.. -I$(srcdir) $(DEFS) -c $<

% : %.o
% : %.cc


LEXERPREFIX = mcc

SOURCES = mccparser.cc Version.cc

CSOURCES = lex.$(LEXERPREFIX).c y.tab.c

HEADERS = $(SOURCES:.cc=.h)

OBJECTS = $(SOURCES:.cc=.o) $(CSOURCES:.c=.o)

LIBRARY = lib$(PACKAGE)

DISTFILES = Makefile.in $(SOURCES) $(HEADERS) mccp.yy mccp.y


all: $(LIBRARY).so.$(VERSION) TAGS

all-static static: $(LIBRARY).a TAGS

$(LIBRARY).so.$(VERSION): $(OBJECTS)
	$(CXX) $(LINKOPTIONS) -o $@ $(LDNAMEPARAM)$@ $(LDFLAGS) $^
	@ ln -sf $@ $(LIBRARY).so

$(LIBRARY).a: $(OBJECTS)
	$(ARXX) $(AROPTIONS) $@ $^

TAGS: $(SOURCES) $(HEADERS)
	@ etags --c++ $^

lex.$(LEXERPREFIX).c: mccp.yy
	$(LEX) -P$(LEXERPREFIX) $<

y.tab.c y.tab.h: mccp.y
	$(YACC) -p $(LEXERPREFIX) -d -t --report=all $^

lex.$(LEXERPREFIX).o: lex.$(LEXERPREFIX).c y.tab.h
	$(CXX) $(CXXFLAGS) -I. -I$(srcdir) $(DEFS) -c $<

lex.$(LEXERPREFIX).lo: lex.$(LEXERPREFIX).c y.tab.h
	$(CXX) $(CXXFLAGS) -I. -I$(srcdir) $(DEFS) -c $< -o $@

y.tab.o: y.tab.c y.tab.h
	$(CXX) $(CXXFLAGS) -I. -I$(srcdir) $(DEFS) -c $<


doc:


install: $(LIBRARY).so.$(VERSION)
	@ echo Installing $(LIBRARY).so in $(libdir)
	@ $(srcdir)/../mkinstalldirs $(libdir)
	@ $(srcdir)/../mkinstalldirs $(includedir)/$(PACKAGE)-$(VERSION)
	@ $(INSTALL_DATA) $^ $(libdir)/$^
	@ $(RM) $(libdir)/$(LIBRARY).so
	@ ln -s $^ $(libdir)/$(LIBRARY).so
	@ for file in $(HEADERS); do \
	   echo Installing $$file in $(includedir)/$(PACKAGE)-$(VERSION); \
           $(INSTALL_DATA) $(srcdir)/$$file $(includedir)/$(PACKAGE)-$(VERSION)/$$file; \
          done;
	@ $(RM) $(includedir)/$(PACKAGE)
	@ ln -s $(PACKAGE)-$(VERSION) $(includedir)/$(PACKAGE)

install-static: static
	@ echo Installing $(LIBRARY).a in $(libdir)
	@ $(srcdir)/../mkinstalldirs $(libdir)
	@ $(srcdir)/../mkinstalldirs $(includedir)/$(PACKAGE)-$(VERSION)
	@ $(INSTALL_DATA) $(LIBRARY).a $(libdir)/$(LIBRARY)-$(VERSION).a
	@ $(RM) $(libdir)/$(LIBRARY).a
	@ ln -s $(LIBRARY)-$(VERSION).a $(libdir)/$(LIBRARY).a
	@ echo Installing headers in $(includedir)/$(PACKAGE)-$(VERSION)
	@ for file in $(HEADERS); do \
           $(INSTALL_DATA) $(srcdir)/$$file $(includedir)/$(PACKAGE)-$(VERSION)/$$file; \
          done;
	@ $(RM) $(includedir)/$(PACKAGE)
	@ ln -s $(PACKAGE)-$(VERSION) $(includedir)/$(PACKAGE)

install-doc:
	@ echo "Nothing to do"

uninstall:
	@ $(RM) $(libdir)/$(LIBRARY).a
	@ $(RM) $(libdir)/$(LIBRARY)-$(VERSION).a
	@ $(RM) $(libdir)/$(LIBRARY).so
	@ $(RM) $(libdir)/$(LIBRARY).so.$(VERSION)
	@ for file in $(HEADERS); do \
           $(RM) $(includedir)/$(PACKAGE)-$(VERSION)/$$file; \
          done;
	@- rmdir $(includedir)/$(PACKAGE)-$(VERSION)
	@ $(RM) $(includedir)/$(PACKAGE)


mostlyclean:
	@ $(RM) *~
	@ $(RM) core

clean: mostlyclean
	@ echo "Cleaning project"
	@ $(RM) $(LIBRARY).so $(LIBRARY).so.$(VERSION) $(LIBRARY).a
	@ $(RM) $(OBJECTS) TAGS
	@ $(RM) lex.$(LEXERPREFIX).c y.tab.c y.tab.h
	@ $(RM) *.d

distclean: clean
	@ $(RM) Makefile

topclean: distclean
	@ echo "The project is getting _top_ clean\!"

release: static

dist:
	@ echo "Copying distribution files"
	@ for file in $(DISTFILES); do \
	   ln $(srcdir)/$$file ../$(PACKAGE)-$(VERSION)/lib 2> /dev/null \
	    || cp -p $(srcdir)/$$file ../$(PACKAGE)$(VERSION)/lib; \
	  done

Makefile: $(srcdir)/Makefile.in ../config.status
	@ cd .. && CONFIG_FILES=lib/$@ CONFIG_HEADERS= ./config.status

# Tell versions [3.59,3.63) of GNU make not to export all variables.
# Otherwise a system limit (for SysV at least) may be exceeded.
.NOEXPORT:

-include $(SOURCES:.cc=.d)
